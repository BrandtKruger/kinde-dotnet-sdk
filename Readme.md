### Overview

This project should help users to access Kinde api with oauth authentication. It contains 3 pre-built OAuth flows: client credentials, authorization code and authorization code with PKCE code verifier. After build it produces nuget package, which should be published to nuget repository.

### Build

VS automaticaly recreates access client using yaml metadata on build. Right now it references to static file, but it can be re-targeted to some web published file to get latest one for each build. in this case nuget will be built with latest api version. Nuget package will be built automaticaly too. But publishing to nuget.org requires additional setup. 

### Usage

##### Don't use constructor without <code>IIdentityProviderConfiguration</code> parameter. This will throw exceptions.

Identity provider configuration contains these parameters:
- Domain. Base domain used for authorization. must be subdomain of kinde.com. F.E. testauth.kinde.com
- ReplyUrl. Unused for client credentials, but used as callback url for other flows. May be null for client credentials

Additional requirements (based on flow)
- ClientID, required.
- ClientSecret, required.
- Scope, required.
- State, optional. Can be set to null, then will be autogenerated.
- Code verifier generic parameter, required. Use inbuilt SHA256CodeVerifier, or create other one if needed. 

#### 1. Any NOT web application

For not web application only client credentials flow can be used. Because other flows requires user interaction via browser. 
Example: <br>
```csharp
var client = new Kinde.KindeClient(
    new IdentityProviderConfiguration("https://testauth.kinde.com", "https://test.domain.com/callback"), 
    new KindeHttpClient());
await client.Authorize(new ClientCredentialsConfiguration("clientId_here","openid offline any_other_scope", "client secret here"));
```

After this you can call any api methods on this instance.

#### 2. Web applications

For web applications api clients should be connected to user session. To keep them sync use <code>KindeClientFactory</code>. I t has thread safe dictionary to save client instances. It is highly recommended to use Session Id or something like this as a key for instance.

Example:<br>
```csharp
var client = KindeClientFactory.Instance.GetOrCreate(Session.Id, new IdentityProviderConfiguration(domain, callbackUrl));
await client.Authorize(
    new PKCEConfiguration<SHA256CodeVerifier>("clientId", "openid offline any_other_scope", "client secret here", null));
 // This flow requres user redirection, so get url and redirect
context.Response.Redirect(await client.GetRedirectionUrl(correlationId));
```

This code won't authenticate user complletely. We should wait for data on callback endpoint and execute this: <br>
```csharp
var code = context.Request.Query["code"];
var state = context.Request.Query["state"];
KindeClient.OnCodeRecieved(code, state);
var client = KindeClientFactory.Instance.GetOrCreate(Session.Id, new IdentityProviderConfiguration(domain, callbackUrl) //already authorized instance
```


Note, that state parameter must not be constant. It must be random for each call.
More usage examples can be found in Kinde.DemoMvc project.

